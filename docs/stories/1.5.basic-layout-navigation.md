# Story 1.5: Basic Layout & Navigation

## Status
Ready for Development

## Story
**As a** user navigating the WikiGaiaLab platform,
**I want** a consistent, intuitive layout with clear navigation across all sections,
**so that** I can easily access features, understand my location within the platform, and seamlessly transition between authentication states.

## Context & Integration with Epic 1
This story completes Epic 1: Foundation by providing the navigation and layout infrastructure that connects all previous stories (1.1-1.4) into a cohesive user experience. It serves as the structural foundation for Epic 2 features, ensuring users can efficiently navigate between problem browsing, voting, and profile management.

## Acceptance Criteria
1. **Responsive Header with Authentication States**: Header adapts to authenticated/unauthenticated states with proper user menu integration
2. **Navigation Menu with Proper Routing**: Clear navigation structure with active states and seamless routing
3. **Footer with Project Information**: Professional footer with partnership information and legal links
4. **Basic Page Layouts and Components**: Consistent layout system for all page types
5. **User Onboarding Flow Navigation**: Guided navigation for new users through the platform
6. **Mobile-First Responsive Design**: Optimized navigation experience across all devices
7. **Accessibility Compliance (WCAG AA)**: Inclusive navigation with proper keyboard support
8. **Integration with All Previous Stories**: Seamless connection to auth, landing page, and database systems

## Tasks / Subtasks

### **Task 1: Responsive Header with Authentication States** (AC: 1)
- [ ] **Main Header Component Architecture**
  - [ ] Create responsive header with WikiGaiaLab branding and logo
  - [ ] Implement authentication state detection and conditional rendering
  - [ ] Add mobile hamburger menu with smooth animations
  - [ ] Include breadcrumb navigation for deep pages
  - [ ] Integrate with Story 1.3 authentication context

- [ ] **User Menu Integration**
  - [ ] Design user dropdown menu with profile photo and name
  - [ ] Add user statistics (votes cast, problems proposed)
  - [ ] Include quick actions (propose problem, view profile)
  - [ ] Implement logout functionality with confirmation
  - [ ] Add admin panel access for admin users

- [ ] **Authentication State Management**
  - [ ] Handle loading states during authentication checks
  - [ ] Display appropriate CTAs for unauthenticated users
  - [ ] Add notification badges for user activities
  - [ ] Implement session expiration warnings
  - [ ] Include guest user experience hints

### **Task 2: Navigation Menu with Proper Routing** (AC: 2)
- [ ] **Primary Navigation Structure**
  - [ ] Create main navigation with Italian labels (Home, Problemi, Le Mie App, Profilo)
  - [ ] Implement active state styling with clear visual indicators
  - [ ] Add role-based navigation (admin-only items)
  - [ ] Include navigation analytics tracking
  - [ ] Optimize for keyboard navigation

- [ ] **Mobile Navigation Implementation**
  - [ ] Design slide-out mobile menu with touch gestures
  - [ ] Add close button and overlay for mobile menu
  - [ ] Implement swipe-to-close functionality
  - [ ] Include mobile-specific navigation shortcuts
  - [ ] Add mobile search functionality

- [ ] **Routing and Page Transitions**
  - [ ] Implement smooth page transitions with loading states
  - [ ] Add route protection for authenticated pages
  - [ ] Include 404 error handling with helpful navigation
  - [ ] Implement back navigation breadcrumbs
  - [ ] Add deep linking support for all sections

### **Task 3: Footer with Project Information** (AC: 3)
- [ ] **Partnership and Branding Footer**
  - [ ] Display Ass.Gaia and Ecologicaleaving logos with descriptions
  - [ ] Include "Innovazione sociale e tecnologia per il bene comune" messaging
  - [ ] Add social media links and community information
  - [ ] Include project mission statement
  - [ ] Add contact information and support links

- [ ] **Legal and Compliance Information**
  - [ ] Add privacy policy and terms of service links
  - [ ] Include GDPR compliance information
  - [ ] Add cookie policy and data protection notice
  - [ ] Include accessibility statement
  - [ ] Add copyright information and licensing

- [ ] **Community and Support Links**
  - [ ] Include community guidelines and moderation info
  - [ ] Add help center and FAQ links
  - [ ] Include feedback and suggestion submission
  - [ ] Add developer documentation links
  - [ ] Include platform statistics and transparency info

### **Task 4: Basic Page Layouts and Components** (AC: 4)
- [ ] **Layout System Architecture**
  - [ ] Create base layout components (AuthenticatedLayout, UnauthenticatedLayout)
  - [ ] Implement consistent spacing and grid system
  - [ ] Add page header component with titles and actions
  - [ ] Create sidebar layout for admin and profile pages
  - [ ] Include responsive container components

- [ ] **Page Template Components**
  - [ ] Design dashboard layout with widget areas
  - [ ] Create form page layout with validation display
  - [ ] Implement list page layout with filtering
  - [ ] Add detail page layout with actions and metadata
  - [ ] Include error page layouts (404, 500, maintenance)

- [ ] **Content Area Management**
  - [ ] Implement scroll management and position restoration
  - [ ] Add content loading states and skeletons
  - [ ] Include infinite scroll containers
  - [ ] Add content search and filtering layouts
  - [ ] Implement responsive content grids

### **Task 5: User Onboarding Flow Navigation** (AC: 5)
- [ ] **Guided Tour Implementation**
  - [ ] Create interactive onboarding overlay system
  - [ ] Add step-by-step navigation with progress indicators
  - [ ] Include contextual help tooltips and hints
  - [ ] Implement skip and resume functionality
  - [ ] Add completion tracking and rewards

- [ ] **Progressive Disclosure Navigation**
  - [ ] Design feature discovery system
  - [ ] Add "What's New" navigation for returning users
  - [ ] Include personalized navigation recommendations
  - [ ] Implement adaptive navigation based on user activity
  - [ ] Add navigation usage analytics

- [ ] **Help and Support Integration**
  - [ ] Include contextual help system in navigation
  - [ ] Add quick help access from any page
  - [ ] Implement search within help content
  - [ ] Include video tutorial integration
  - [ ] Add community support links

### **Task 6: Mobile-First Responsive Design** (AC: 6)
- [ ] **Touch-Optimized Navigation**
  - [ ] Design touch-friendly navigation elements (min 44px)
  - [ ] Implement swipe gestures for mobile navigation
  - [ ] Add pull-to-refresh functionality
  - [ ] Include haptic feedback for touch interactions
  - [ ] Optimize for one-handed mobile use

- [ ] **Responsive Layout Adaptation**
  - [ ] Implement breakpoint-specific navigation layouts
  - [ ] Add tablet-specific navigation optimizations
  - [ ] Include landscape mode navigation adjustments
  - [ ] Optimize for various screen densities
  - [ ] Add responsive navigation performance optimization

- [ ] **Cross-Device Consistency**
  - [ ] Ensure navigation state persistence across devices
  - [ ] Add device-specific navigation preferences
  - [ ] Include cross-device navigation sync
  - [ ] Implement responsive navigation testing
  - [ ] Add navigation performance monitoring

### **Task 7: Accessibility Compliance (WCAG AA)** (AC: 7)
- [ ] **Keyboard Navigation**
  - [ ] Implement full keyboard navigation support
  - [ ] Add focus management and visual focus indicators
  - [ ] Include keyboard shortcuts for power users
  - [ ] Implement skip links for screen readers
  - [ ] Add aria labels and descriptions for all navigation elements

- [ ] **Screen Reader Optimization**
  - [ ] Add semantic HTML structure for navigation
  - [ ] Include proper heading hierarchy
  - [ ] Implement live regions for dynamic content
  - [ ] Add meaningful alt text for navigation images
  - [ ] Include screen reader testing and validation

- [ ] **Visual Accessibility**
  - [ ] Ensure sufficient color contrast for all navigation elements
  - [ ] Add support for reduced motion preferences
  - [ ] Include high contrast mode compatibility
  - [ ] Implement scalable text support (up to 200%)
  - [ ] Add visual accessibility testing

### **Task 8: Integration with All Previous Stories** (AC: 8)
- [ ] **Authentication System Integration**
  - [ ] Connect with Story 1.3 authentication context
  - [ ] Implement user state-aware navigation
  - [ ] Add authentication-protected navigation items
  - [ ] Include login/logout navigation flows
  - [ ] Add authentication error handling in navigation

- [ ] **Landing Page Integration**
  - [ ] Connect with Story 1.4 landing page components
  - [ ] Implement smooth transition from landing to authenticated areas
  - [ ] Add landing page-specific navigation elements
  - [ ] Include conversion tracking for navigation CTAs
  - [ ] Add A/B testing support for navigation elements

- [ ] **Database and API Integration**
  - [ ] Connect with Story 1.2 database schema for user data
  - [ ] Implement real-time navigation updates
  - [ ] Add navigation analytics tracking
  - [ ] Include user preference persistence
  - [ ] Add navigation performance monitoring

## Dev Notes

### **Previous Stories Integration Context**
- **Story 1.1**: Project setup with Next.js 14 App Router, TypeScript, Tailwind CSS
- **Story 1.2**: Database schema with users, problems, categories tables
- **Story 1.3**: Authentication system with Google OAuth and Supabase
- **Story 1.4**: Landing page with value proposition and conversion optimization

### **Current Project Structure Analysis**
The project already has a basic structure with some navigation components in place:
- `src/components/auth/UserMenu.tsx` - Basic user menu component
- `src/app/layout.tsx` - Root layout with basic structure
- `src/app/page.tsx` - Landing page
- Authentication system is implemented and functional
- Responsive design foundation with Tailwind CSS

### **Navigation Architecture**

**Primary Navigation Structure**:
```typescript
interface NavigationItem {
  id: string;
  label: string;
  href: string;
  icon?: React.ComponentType;
  requiresAuth?: boolean;
  adminOnly?: boolean;
  badge?: number;
  active?: boolean;
}

const navigationItems: NavigationItem[] = [
  { id: 'home', label: 'Home', href: '/', icon: Home },
  { id: 'problems', label: 'Problemi', href: '/problems', icon: Lightbulb, requiresAuth: true },
  { id: 'apps', label: 'Le Mie App', href: '/apps', icon: Apps, requiresAuth: true },
  { id: 'profile', label: 'Profilo', href: '/profile', icon: User, requiresAuth: true },
  { id: 'admin', label: 'Admin', href: '/admin', icon: Shield, adminOnly: true }
];
```

**Layout System Architecture**:
```typescript
// Base layout types
interface LayoutProps {
  children: React.ReactNode;
  title?: string;
  showHeader?: boolean;
  showFooter?: boolean;
  showSidebar?: boolean;
  requiresAuth?: boolean;
}

// Layout components hierarchy
├── RootLayout (app/layout.tsx)
│   ├── Header
│   ├── Navigation
│   ├── Main Content Area
│   └── Footer
├── AuthenticatedLayout
│   ├── Enhanced Header with User Menu
│   ├── Primary Navigation
│   └── User-specific Footer
└── UnauthenticatedLayout
    ├── Minimal Header
    ├── CTA-focused Navigation
    └── Marketing Footer
```

### **Component Specifications**

**Enhanced Header Component**:
```typescript
// apps/web/src/components/layout/Header.tsx
interface HeaderProps {
  variant: 'landing' | 'authenticated' | 'admin';
  showBreadcrumbs?: boolean;
  showSearch?: boolean;
  showNotifications?: boolean;
}

export const Header: React.FC<HeaderProps> = ({
  variant,
  showBreadcrumbs = false,
  showSearch = false,
  showNotifications = false
}) => {
  const { user, loading } = useAuth();
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const [notificationCount, setNotificationCount] = useState(0);

  return (
    <header className="sticky top-0 z-50 bg-white border-b border-gray-200">
      <div className="container mx-auto px-4">
        <div className="flex items-center justify-between h-16">
          {/* Logo and Branding */}
          <div className="flex items-center">
            <Link href="/" className="flex items-center space-x-2">
              <Image
                src="/images/wikigaialab-logo.svg"
                alt="WikiGaiaLab"
                width={40}
                height={40}
                className="h-8 w-8"
              />
              <span className="text-xl font-bold text-primary-900">
                WikiGaiaLab
              </span>
            </Link>
          </div>

          {/* Desktop Navigation */}
          <nav className="hidden md:flex items-center space-x-8">
            {navigationItems
              .filter(item => {
                if (item.adminOnly && !user?.is_admin) return false;
                if (item.requiresAuth && !user) return false;
                return true;
              })
              .map(item => (
                <NavigationLink
                  key={item.id}
                  href={item.href}
                  icon={item.icon}
                  badge={item.badge}
                  active={item.active}
                >
                  {item.label}
                </NavigationLink>
              ))}
          </nav>

          {/* User Menu / Auth Actions */}
          <div className="flex items-center space-x-4">
            {user ? (
              <UserMenu
                user={user}
                showNotifications={showNotifications}
                notificationCount={notificationCount}
              />
            ) : (
              <GoogleLoginButton size="sm" />
            )}
            
            {/* Mobile Menu Button */}
            <button
              className="md:hidden"
              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
              aria-label="Toggle mobile menu"
            >
              {mobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
            </button>
          </div>
        </div>

        {/* Breadcrumbs */}
        {showBreadcrumbs && (
          <div className="py-2 border-t border-gray-100">
            <Breadcrumbs />
          </div>
        )}
      </div>

      {/* Mobile Menu */}
      <MobileMenu 
        isOpen={mobileMenuOpen} 
        onClose={() => setMobileMenuOpen(false)}
        navigationItems={navigationItems}
        user={user}
      />
    </header>
  );
};
```

**Navigation Link Component**:
```typescript
// apps/web/src/components/layout/NavigationLink.tsx
interface NavigationLinkProps {
  href: string;
  children: React.ReactNode;
  icon?: React.ComponentType<{ size?: number }>;
  badge?: number;
  active?: boolean;
  onClick?: () => void;
}

export const NavigationLink: React.FC<NavigationLinkProps> = ({
  href,
  children,
  icon: Icon,
  badge,
  active,
  onClick
}) => {
  const pathname = usePathname();
  const isActive = active || pathname === href;

  return (
    <Link
      href={href}
      className={cn(
        "flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",
        isActive 
          ? "bg-primary-100 text-primary-900" 
          : "text-gray-600 hover:text-gray-900 hover:bg-gray-50"
      )}
      onClick={onClick}
    >
      {Icon && <Icon size={16} />}
      <span>{children}</span>
      {badge && badge > 0 && (
        <span className="ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
          {badge > 99 ? '99+' : badge}
        </span>
      )}
    </Link>
  );
};
```

**Mobile Menu Component**:
```typescript
// apps/web/src/components/layout/MobileMenu.tsx
interface MobileMenuProps {
  isOpen: boolean;
  onClose: () => void;
  navigationItems: NavigationItem[];
  user: AuthUser | null;
}

export const MobileMenu: React.FC<MobileMenuProps> = ({
  isOpen,
  onClose,
  navigationItems,
  user
}) => {
  const [touchStart, setTouchStart] = useState<number | null>(null);
  const [touchEnd, setTouchEnd] = useState<number | null>(null);

  const handleTouchStart = (e: React.TouchEvent) => {
    setTouchEnd(null);
    setTouchStart(e.targetTouches[0].clientX);
  };

  const handleTouchMove = (e: React.TouchEvent) => {
    setTouchEnd(e.targetTouches[0].clientX);
  };

  const handleTouchEnd = () => {
    if (!touchStart || !touchEnd) return;
    
    const distance = touchStart - touchEnd;
    const isLeftSwipe = distance > 50;
    const isRightSwipe = distance < -50;

    if (isLeftSwipe && isOpen) {
      onClose();
    }
  };

  return (
    <>
      {/* Overlay */}
      <div
        className={cn(
          "fixed inset-0 bg-black bg-opacity-50 transition-opacity z-40",
          isOpen ? "opacity-100" : "opacity-0 pointer-events-none"
        )}
        onClick={onClose}
      />

      {/* Mobile Menu Panel */}
      <div
        className={cn(
          "fixed top-0 right-0 h-full w-80 bg-white shadow-xl transform transition-transform z-50",
          isOpen ? "translate-x-0" : "translate-x-full"
        )}
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
        onTouchEnd={handleTouchEnd}
      >
        <div className="p-4 border-b border-gray-200">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-semibold">Menu</h2>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-md"
              aria-label="Close menu"
            >
              <X size={20} />
            </button>
          </div>
        </div>

        <nav className="p-4 space-y-2">
          {navigationItems
            .filter(item => {
              if (item.adminOnly && !user?.is_admin) return false;
              if (item.requiresAuth && !user) return false;
              return true;
            })
            .map(item => (
              <NavigationLink
                key={item.id}
                href={item.href}
                icon={item.icon}
                badge={item.badge}
                onClick={onClose}
              >
                {item.label}
              </NavigationLink>
            ))}
        </nav>

        {/* User Section */}
        {user ? (
          <div className="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200">
            <UserProfile user={user} variant="mobile" />
          </div>
        ) : (
          <div className="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200">
            <GoogleLoginButton size="sm" className="w-full" />
          </div>
        )}
      </div>
    </>
  );
};
```

**Footer Component**:
```typescript
// apps/web/src/components/layout/Footer.tsx
export const Footer: React.FC = () => {
  const currentYear = new Date().getFullYear();

  return (
    <footer className="bg-gray-50 border-t border-gray-200">
      <div className="container mx-auto px-4 py-12">
        <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
          {/* Brand and Mission */}
          <div className="col-span-1 md:col-span-2">
            <div className="flex items-center space-x-3 mb-4">
              <Image
                src="/images/wikigaialab-logo.svg"
                alt="WikiGaiaLab"
                width={32}
                height={32}
              />
              <span className="text-xl font-bold text-primary-900">
                WikiGaiaLab
              </span>
            </div>
            <p className="text-gray-600 mb-6 max-w-md">
              Innovazione sociale e tecnologia per il bene comune. 
              Una piattaforma community che democratizza lo sviluppo di soluzioni AI.
            </p>
            
            {/* Partnership Logos */}
            <div className="flex items-center space-x-6">
              <div className="text-center">
                <Image
                  src="/images/ass-gaia-logo.png"
                  alt="Ass.Gaia"
                  width={60}
                  height={30}
                  className="mb-2"
                />
                <p className="text-xs text-gray-500">Community Partner</p>
              </div>
              <div className="text-center">
                <Image
                  src="/images/ecologicaleaving-logo.png"
                  alt="Ecologicaleaving"
                  width={60}
                  height={30}
                  className="mb-2"
                />
                <p className="text-xs text-gray-500">Technology Partner</p>
              </div>
            </div>
          </div>

          {/* Community Links */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-4">Community</h3>
            <ul className="space-y-2 text-sm">
              <li><Link href="/problems" className="text-gray-600 hover:text-primary-600">Problemi</Link></li>
              <li><Link href="/apps" className="text-gray-600 hover:text-primary-600">App Sviluppate</Link></li>
              <li><Link href="/leaderboard" className="text-gray-600 hover:text-primary-600">Classifica</Link></li>
              <li><Link href="/guidelines" className="text-gray-600 hover:text-primary-600">Linee Guida</Link></li>
            </ul>
          </div>

          {/* Support and Legal */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-4">Supporto</h3>
            <ul className="space-y-2 text-sm">
              <li><Link href="/help" className="text-gray-600 hover:text-primary-600">Centro Aiuto</Link></li>
              <li><Link href="/contact" className="text-gray-600 hover:text-primary-600">Contattaci</Link></li>
              <li><Link href="/privacy" className="text-gray-600 hover:text-primary-600">Privacy Policy</Link></li>
              <li><Link href="/terms" className="text-gray-600 hover:text-primary-600">Termini di Servizio</Link></li>
            </ul>
          </div>
        </div>

        {/* Bottom Bar */}
        <div className="mt-12 pt-8 border-t border-gray-200 flex flex-col sm:flex-row justify-between items-center">
          <div className="text-sm text-gray-500">
            © {currentYear} WikiGaiaLab. Tutti i diritti riservati.
          </div>
          <div className="flex space-x-6 mt-4 sm:mt-0">
            <Link href="https://twitter.com/wikigaialab" className="text-gray-400 hover:text-primary-600">
              <Twitter size={20} />
            </Link>
            <Link href="https://facebook.com/wikigaialab" className="text-gray-400 hover:text-primary-600">
              <Facebook size={20} />
            </Link>
            <Link href="https://instagram.com/wikigaialab" className="text-gray-400 hover:text-primary-600">
              <Instagram size={20} />
            </Link>
          </div>
        </div>
      </div>
    </footer>
  );
};
```

### **Layout System Implementation**

**Base Layout Component**:
```typescript
// apps/web/src/components/layout/BaseLayout.tsx
interface BaseLayoutProps {
  children: React.ReactNode;
  variant: 'landing' | 'authenticated' | 'admin';
  title?: string;
  showBreadcrumbs?: boolean;
  showSearch?: boolean;
  showNotifications?: boolean;
}

export const BaseLayout: React.FC<BaseLayoutProps> = ({
  children,
  variant,
  title,
  showBreadcrumbs = false,
  showSearch = false,
  showNotifications = false
}) => {
  const { user, loading } = useAuth();

  if (loading) {
    return <LoadingSpinner />;
  }

  return (
    <div className="min-h-screen bg-gray-50 flex flex-col">
      <Header
        variant={variant}
        showBreadcrumbs={showBreadcrumbs}
        showSearch={showSearch}
        showNotifications={showNotifications}
      />
      
      <main className="flex-1">
        {title && (
          <div className="bg-white border-b border-gray-200">
            <div className="container mx-auto px-4 py-6">
              <h1 className="text-2xl font-bold text-gray-900">{title}</h1>
            </div>
          </div>
        )}
        {children}
      </main>
      
      <Footer />
    </div>
  );
};
```

**Authenticated Layout**:
```typescript
// apps/web/src/components/layout/AuthenticatedLayout.tsx
interface AuthenticatedLayoutProps {
  children: React.ReactNode;
  title?: string;
  showSidebar?: boolean;
  sidebarContent?: React.ReactNode;
}

export const AuthenticatedLayout: React.FC<AuthenticatedLayoutProps> = ({
  children,
  title,
  showSidebar = false,
  sidebarContent
}) => {
  return (
    <ProtectedRoute>
      <BaseLayout
        variant="authenticated"
        title={title}
        showBreadcrumbs={true}
        showSearch={true}
        showNotifications={true}
      >
        {showSidebar ? (
          <div className="container mx-auto px-4 py-6">
            <div className="flex gap-6">
              <aside className="w-64 flex-shrink-0">
                {sidebarContent}
              </aside>
              <main className="flex-1">
                {children}
              </main>
            </div>
          </div>
        ) : (
          <div className="container mx-auto px-4 py-6">
            {children}
          </div>
        )}
      </BaseLayout>
    </ProtectedRoute>
  );
};
```

### **File Structure**
```
apps/web/src/
├── components/
│   ├── layout/
│   │   ├── Header.tsx (Enhanced with all states)
│   │   ├── Footer.tsx (Complete with partnership info)
│   │   ├── NavigationLink.tsx (Reusable nav item)
│   │   ├── MobileMenu.tsx (Touch-optimized mobile nav)
│   │   ├── Breadcrumbs.tsx (Navigation breadcrumbs)
│   │   ├── BaseLayout.tsx (Base layout system)
│   │   ├── AuthenticatedLayout.tsx (Authenticated user layout)
│   │   ├── UnauthenticatedLayout.tsx (Guest user layout)
│   │   └── AdminLayout.tsx (Admin-specific layout)
│   ├── auth/ (Integration with Story 1.3)
│   │   ├── UserMenu.tsx (Enhanced user dropdown)
│   │   └── UserProfile.tsx (User profile widget)
│   └── ui/
│       ├── LoadingSpinner.tsx
│       └── Button.tsx
├── hooks/
│   ├── useAuth.ts (From Story 1.3)
│   ├── useNavigation.ts (Navigation state management)
│   └── useBreakpoint.ts (Responsive breakpoint hook)
├── lib/
│   ├── navigation.ts (Navigation configuration)
│   └── analytics.ts (Navigation analytics)
└── types/
    └── navigation.ts (Navigation type definitions)
```

### **Responsive Design Strategy**

**Breakpoint Configuration**:
```typescript
// apps/web/src/lib/responsive.ts
export const breakpoints = {
  sm: '640px',
  md: '768px',
  lg: '1024px',
  xl: '1280px',
  '2xl': '1536px'
} as const;

export const useBreakpoint = () => {
  const [breakpoint, setBreakpoint] = useState<keyof typeof breakpoints>('sm');

  useEffect(() => {
    const updateBreakpoint = () => {
      const width = window.innerWidth;
      if (width >= 1536) setBreakpoint('2xl');
      else if (width >= 1280) setBreakpoint('xl');
      else if (width >= 1024) setBreakpoint('lg');
      else if (width >= 768) setBreakpoint('md');
      else setBreakpoint('sm');
    };

    updateBreakpoint();
    window.addEventListener('resize', updateBreakpoint);
    return () => window.removeEventListener('resize', updateBreakpoint);
  }, []);

  return breakpoint;
};
```

**Mobile-First Navigation**:
```typescript
// Navigation adaptation for different screen sizes
const NavigationAdapter = () => {
  const breakpoint = useBreakpoint();
  const isMobile = breakpoint === 'sm' || breakpoint === 'md';

  return isMobile ? (
    <MobileNavigation />
  ) : (
    <DesktopNavigation />
  );
};
```

### **Accessibility Implementation**

**Keyboard Navigation**:
```typescript
// apps/web/src/hooks/useKeyboardNavigation.ts
export const useKeyboardNavigation = () => {
  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      // Alt + M: Open mobile menu
      if (event.altKey && event.key === 'm') {
        event.preventDefault();
        // Toggle mobile menu
      }
      
      // Alt + H: Go to home
      if (event.altKey && event.key === 'h') {
        event.preventDefault();
        router.push('/');
      }
      
      // Alt + P: Go to problems
      if (event.altKey && event.key === 'p') {
        event.preventDefault();
        router.push('/problems');
      }
    };

    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, []);
};
```

**Skip Links**:
```typescript
// apps/web/src/components/layout/SkipLinks.tsx
export const SkipLinks: React.FC = () => {
  return (
    <div className="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 bg-primary-600 text-white p-4 z-50">
      <Link href="#main-content" className="mr-4 underline">
        Vai al contenuto principale
      </Link>
      <Link href="#navigation" className="mr-4 underline">
        Vai alla navigazione
      </Link>
      <Link href="#footer" className="underline">
        Vai al footer
      </Link>
    </div>
  );
};
```

### **Performance Optimization**

**Code Splitting**:
```typescript
// Lazy load navigation components
const MobileMenu = dynamic(() => import('./MobileMenu'), {
  ssr: false,
  loading: () => <div>Loading...</div>
});

const UserMenu = dynamic(() => import('./UserMenu'), {
  ssr: false
});
```

**Navigation Analytics**:
```typescript
// apps/web/src/lib/navigation-analytics.ts
export const trackNavigation = (from: string, to: string, method: 'click' | 'keyboard' | 'swipe') => {
  gtag('event', 'navigation', {
    event_category: 'navigation',
    event_label: `${from} -> ${to}`,
    method,
    timestamp: new Date().toISOString()
  });
};
```

### **Testing Strategy**

**Unit Tests**:
```typescript
// apps/web/tests/unit/layout/Header.test.tsx
describe('Header', () => {
  it('renders authenticated state correctly', () => {
    render(<Header variant="authenticated" />, { wrapper: AuthProvider });
    expect(screen.getByText('Profilo')).toBeInTheDocument();
  });

  it('shows mobile menu on small screens', () => {
    Object.defineProperty(window, 'innerWidth', { value: 600 });
    render(<Header variant="authenticated" />);
    expect(screen.getByLabelText('Toggle mobile menu')).toBeInTheDocument();
  });
});
```

**E2E Tests**:
```typescript
// apps/web/tests/e2e/navigation.spec.ts
test('navigation works across all pages', async ({ page }) => {
  await page.goto('/');
  await page.click('[data-testid="nav-problems"]');
  await expect(page).toHaveURL('/problems');
  
  await page.click('[data-testid="nav-apps"]');
  await expect(page).toHaveURL('/apps');
  
  await page.click('[data-testid="nav-profile"]');
  await expect(page).toHaveURL('/profile');
});
```

### **Integration Points**

**Authentication Integration**:
```typescript
// Connect with Story 1.3 authentication
import { useAuth } from '@/hooks/useAuth';
import { ProtectedRoute } from '@/components/auth/ProtectedRoute';

// Navigation adapts based on authentication state
const NavigationItems = () => {
  const { user } = useAuth();
  
  return navigationItems.filter(item => {
    if (item.requiresAuth && !user) return false;
    if (item.adminOnly && !user?.is_admin) return false;
    return true;
  });
};
```

**Landing Page Integration**:
```typescript
// Different navigation for landing page
const LandingNavigation = () => {
  return (
    <nav className="flex items-center space-x-6">
      <Link href="#features">Funzionalità</Link>
      <Link href="#community">Community</Link>
      <Link href="#pricing">Prezzi</Link>
      <GoogleLoginButton />
    </nav>
  );
};
```

### **Quality Assurance Checklist**
- [ ] Header renders correctly in all authentication states
- [ ] Mobile menu opens/closes smoothly with touch gestures
- [ ] Navigation items show/hide based on user permissions
- [ ] Footer displays partnership information correctly
- [ ] All navigation links work and show active states
- [ ] Breadcrumbs update correctly on page changes
- [ ] User menu shows user information and actions
- [ ] Mobile navigation is touch-friendly (44px minimum)
- [ ] Keyboard navigation works for all interactive elements
- [ ] Screen reader navigation is semantic and clear
- [ ] Color contrast meets WCAG AA standards
- [ ] Navigation performance is optimized (lazy loading)
- [ ] Cross-browser compatibility verified
- [ ] Responsive design works on all device sizes
- [ ] Analytics tracking works for all navigation events

### **Definition of Done**
- [ ] Responsive header with authentication state management
- [ ] Complete navigation menu with proper routing
- [ ] Professional footer with partnership information
- [ ] Consistent layout system for all page types
- [ ] User onboarding navigation flow
- [ ] Mobile-first responsive design implemented
- [ ] WCAG AA accessibility compliance verified
- [ ] Integration with Stories 1.1-1.4 complete
- [ ] Performance optimization implemented
- [ ] Cross-device testing passed
- [ ] Analytics integration functional
- [ ] Unit and E2E tests passing
- [ ] Error handling and fallbacks implemented
- [ ] Documentation updated
- [ ] Code review completed

### **Common Pitfalls and Solutions**

1. **Mobile Menu Performance Issues**:
   - **Problem**: Heavy animations cause janky mobile experience
   - **Solution**: Use CSS transforms and will-change property
   - **Test**: Test on actual mobile devices with performance monitoring

2. **Authentication State Sync Issues**:
   - **Problem**: Navigation doesn't update when auth state changes
   - **Solution**: Proper React Context integration and state management
   - **Test**: Test login/logout flows and verify navigation updates

3. **Accessibility Navigation Issues**:
   - **Problem**: Screen readers can't navigate effectively
   - **Solution**: Proper semantic HTML, ARIA labels, and skip links
   - **Test**: Test with screen readers and keyboard-only navigation

4. **Cross-Device Navigation Inconsistencies**:
   - **Problem**: Navigation behaves differently on different devices
   - **Solution**: Responsive design testing and consistent breakpoints
   - **Test**: Test on multiple devices and screen sizes

5. **Performance on Slow Networks**:
   - **Problem**: Navigation components load slowly
   - **Solution**: Code splitting, lazy loading, and performance optimization
   - **Test**: Test on slow 3G connections and optimize critical path

### **Success Metrics**
- **Navigation Usage**: 90%+ users navigate beyond landing page
- **Mobile Navigation**: 95%+ mobile users can navigate effectively
- **Authentication Flow**: 85%+ users complete navigation post-login
- **Performance**: Navigation interactions < 100ms response time
- **Accessibility**: 100% keyboard navigation coverage
- **Cross-Device**: Consistent experience across all devices
- **Error Rate**: < 1% navigation-related errors

### **Technical Constraints**
- **Framework**: Next.js 14 with App Router
- **Styling**: Tailwind CSS with responsive utilities
- **Authentication**: Integration with Supabase Auth from Story 1.3
- **Icons**: Lucide React for consistent iconography
- **Typography**: Inter font family for Italian text
- **Accessibility**: WCAG AA compliance required
- **Performance**: 60fps animations, optimized for mobile
- **Browser Support**: Modern browsers (Chrome, Firefox, Safari, Edge)

## Implementation Guidance

### **Enhanced Header Implementation**

Start with the header component that integrates all authentication states:

```typescript
// apps/web/src/components/layout/Header.tsx
import { useState, useEffect } from 'react';
import { useAuth } from '@/hooks/useAuth';
import { useRouter, usePathname } from 'next/navigation';
import { Menu, X, Bell, Search, User, Settings } from 'lucide-react';

export const Header: React.FC<HeaderProps> = ({ variant, showBreadcrumbs, showSearch, showNotifications }) => {
  const { user, loading } = useAuth();
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const pathname = usePathname();
  const router = useRouter();

  // Close mobile menu on route change
  useEffect(() => {
    setMobileMenuOpen(false);
  }, [pathname]);

  const navigationItems = [
    { href: '/', label: 'Home', icon: Home },
    { href: '/problems', label: 'Problemi', icon: Lightbulb, requiresAuth: true },
    { href: '/apps', label: 'Le Mie App', icon: Apps, requiresAuth: true },
    { href: '/profile', label: 'Profilo', icon: User, requiresAuth: true },
    { href: '/admin', label: 'Admin', icon: Shield, adminOnly: true }
  ];

  const filteredNavItems = navigationItems.filter(item => {
    if (item.adminOnly && !user?.is_admin) return false;
    if (item.requiresAuth && !user) return false;
    return true;
  });

  return (
    <header className="sticky top-0 z-50 bg-white shadow-sm">
      <div className="container mx-auto px-4">
        <div className="flex items-center justify-between h-16">
          {/* Logo */}
          <Link href="/" className="flex items-center space-x-2">
            <Image src="/images/logo.svg" alt="WikiGaiaLab" width={32} height={32} />
            <span className="text-xl font-bold text-primary-900">WikiGaiaLab</span>
          </Link>

          {/* Desktop Navigation */}
          <nav className="hidden md:flex items-center space-x-6">
            {filteredNavItems.map(item => (
              <NavigationLink
                key={item.href}
                href={item.href}
                icon={item.icon}
                active={pathname === item.href}
              >
                {item.label}
              </NavigationLink>
            ))}
          </nav>

          {/* Actions */}
          <div className="flex items-center space-x-4">
            {user ? (
              <UserMenu user={user} />
            ) : (
              <GoogleLoginButton size="sm" />
            )}
            
            <button
              className="md:hidden p-2 hover:bg-gray-100 rounded-md"
              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            >
              {mobileMenuOpen ? <X size={20} /> : <Menu size={20} />}
            </button>
          </div>
        </div>
      </div>

      {/* Mobile Menu */}
      <MobileMenu 
        isOpen={mobileMenuOpen}
        onClose={() => setMobileMenuOpen(false)}
        items={filteredNavItems}
        user={user}
      />
    </header>
  );
};
```

### **Mobile Menu with Touch Gestures**

```typescript
// apps/web/src/components/layout/MobileMenu.tsx
export const MobileMenu: React.FC<MobileMenuProps> = ({ isOpen, onClose, items, user }) => {
  const menuRef = useRef<HTMLDivElement>(null);
  
  // Touch gesture handling
  const handleTouchStart = (e: React.TouchEvent) => {
    const touch = e.touches[0];
    setTouchStart(touch.clientX);
  };

  const handleTouchMove = (e: React.TouchEvent) => {
    const touch = e.touches[0];
    setTouchEnd(touch.clientX);
  };

  const handleTouchEnd = () => {
    if (touchStart && touchEnd) {
      const distance = touchStart - touchEnd;
      if (distance > 50) { // Left swipe
        onClose();
      }
    }
    setTouchStart(null);
    setTouchEnd(null);
  };

  return (
    <AnimatePresence>
      {isOpen && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed inset-0 z-50 md:hidden"
        >
          {/* Overlay */}
          <div
            className="fixed inset-0 bg-black bg-opacity-50"
            onClick={onClose}
          />

          {/* Menu Panel */}
          <motion.div
            ref={menuRef}
            initial={{ x: '100%' }}
            animate={{ x: 0 }}
            exit={{ x: '100%' }}
            transition={{ type: 'tween', duration: 0.3 }}
            className="fixed right-0 top-0 h-full w-80 bg-white shadow-xl"
            onTouchStart={handleTouchStart}
            onTouchMove={handleTouchMove}
            onTouchEnd={handleTouchEnd}
          >
            <div className="p-4 border-b">
              <div className="flex items-center justify-between">
                <h2 className="text-lg font-semibold">Menu</h2>
                <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-md">
                  <X size={20} />
                </button>
              </div>
            </div>

            <nav className="p-4 space-y-2">
              {items.map(item => (
                <MobileNavigationLink
                  key={item.href}
                  href={item.href}
                  icon={item.icon}
                  onClick={onClose}
                >
                  {item.label}
                </MobileNavigationLink>
              ))}
            </nav>

            {/* User Section */}
            {user && (
              <div className="absolute bottom-0 left-0 right-0 p-4 border-t">
                <UserProfile user={user} variant="compact" />
              </div>
            )}
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
};
```

### **Breadcrumb Navigation**

```typescript
// apps/web/src/components/layout/Breadcrumbs.tsx
export const Breadcrumbs: React.FC = () => {
  const pathname = usePathname();
  const router = useRouter();

  const generateBreadcrumbs = (path: string) => {
    const segments = path.split('/').filter(Boolean);
    const breadcrumbs = [{ label: 'Home', href: '/' }];

    segments.forEach((segment, index) => {
      const href = '/' + segments.slice(0, index + 1).join('/');
      const label = segment.charAt(0).toUpperCase() + segment.slice(1);
      breadcrumbs.push({ label, href });
    });

    return breadcrumbs;
  };

  const breadcrumbs = generateBreadcrumbs(pathname);

  return (
    <nav className="flex items-center space-x-2 text-sm text-gray-500">
      {breadcrumbs.map((crumb, index) => (
        <div key={crumb.href} className="flex items-center">
          {index > 0 && <ChevronRight size={16} className="mx-2" />}
          {index === breadcrumbs.length - 1 ? (
            <span className="text-gray-900 font-medium">{crumb.label}</span>
          ) : (
            <Link
              href={crumb.href}
              className="hover:text-primary-600 transition-colors"
            >
              {crumb.label}
            </Link>
          )}
        </div>
      ))}
    </nav>
  );
};
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 17/07/2025 | 1.0 | Comprehensive navigation and layout story completing Epic 1 Foundation | Bob (SM) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*This section will be populated after implementation and quality assurance review*